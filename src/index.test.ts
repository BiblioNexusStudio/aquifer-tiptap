// @ts-expect-error bun:test types don't exist
import { expect, test } from "bun:test";
import { parseHtmlAsJson, parseJsonAsHtml } from ".";

function roundTrip(html: string): string {
  const json = [{tiptap: JSON.parse(parseHtmlAsJson(html))}];
  return parseJsonAsHtml(JSON.stringify(json));
}

test("parseHtmlAsJson converts HTML to JSON", () => {
  const html = `<div><p data-indent="2">Hello, world!</p></div>`;
  const result = parseHtmlAsJson(html);
  expect(result).toBe(`{"type":"doc","content":[{"type":"paragraph","attrs":{"indent":2},"content":[{"type":"text","text":"Hello, world!"}]}]}`);
});

test("parseJsonAsHtml converts JSON back to HTML", () => {
  const json = `[{"tiptap":{"type":"doc","content":[{"type":"paragraph","content":[{"type":"text","text":"Hello, world!"}]}]}}]`;
  const result = parseJsonAsHtml(json);
  expect(result).toBe(`<p>Hello, world!</p>`);
});

test("basic round trip works", () => {
  const originalHtml = `<p>Hello, world!</p>`;
  const resultHtml = roundTrip(originalHtml);
  expect(resultHtml).toBe(originalHtml);
});

test("lists", () => {
  const html = `<ol type="1" data-indent="1"><li><p>Lists: The author liked to use lists. He repeated these lists throughout the chapter. For example:</p><ol type="a" data-indent="1"><li><p>the list of the names of officials (3:2, 3, 27)</p></li><li><p>the list of musical instruments (3:5, 7, 10, 15)</p></li><li><p>the phrase: “peoples, nations, and languages” (3:4, 29)</p></li></ol></li><li><p>Repetition: The author also liked to repeat phrases throughout the narrative. Some of these phrases are:</p><ol type="a" data-indent="1"><li><p>“the image that King Nebuchadnezzar set up” (3:1, 2, 3, 5, 7, 12, 14, 18)</p></li><li><p>“hear the sound of the horn” (3:5, 7, 10, 15)</p></li><li><p>“fall down and worship” (3:5, 6, 7, 10, 11, 15)</p></li><li><p>“burning fiery furnace” (3:6, 11, 15, 17, 20, 21, 23, 26)</p></li><li><p>“Shadrach, Meshach, and Abednego” (3:12, 13, 14, 16, 19, 20, 22, 26, 28, 29, 30)</p></li></ol></li></ol>`;
  const result = parseHtmlAsJson(html);
  expect(result).toBe(`{"type":"doc","content":[{"type":"orderedList","attrs":{"start":1,"type":"1","indent":1},"content":[{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"Lists: The author liked to use lists. He repeated these lists throughout the chapter. For example:"}]},{"type":"orderedList","attrs":{"start":1,"type":"a","indent":1},"content":[{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"the list of the names of officials (3:2, 3, 27)"}]}]},{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"the list of musical instruments (3:5, 7, 10, 15)"}]}]},{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"the phrase: “peoples, nations, and languages” (3:4, 29)"}]}]}]}]},{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"Repetition: The author also liked to repeat phrases throughout the narrative. Some of these phrases are:"}]},{"type":"orderedList","attrs":{"start":1,"type":"a","indent":1},"content":[{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"“the image that King Nebuchadnezzar set up” (3:1, 2, 3, 5, 7, 12, 14, 18)"}]}]},{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"“hear the sound of the horn” (3:5, 7, 10, 15)"}]}]},{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"“fall down and worship” (3:5, 6, 7, 10, 11, 15)"}]}]},{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"“burning fiery furnace” (3:6, 11, 15, 17, 20, 21, 23, 26)"}]}]},{"type":"listItem","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"“Shadrach, Meshach, and Abednego” (3:12, 13, 14, 16, 19, 20, 22, 26, 28, 29, 30)"}]}]}]}]}]}]}`);

  const resultHtml = roundTrip(html);
  expect(resultHtml).toBe(html);
});

test("open translator's notes", () => {
  const originalHtml = `<div data-bnType="OpenTranslatorsNotesSection" data-startVerseId="1006001001" data-endVerseId="1006001009"><h3>Section 1:1–9 Yahweh spoke to Joshua</h3><p data-indent="1">In this section Yahweh commanded Joshua to lead the Israelites into the land that he had promised them. He told Joshua that no enemy would be able to oppose him, and that he must obey the law which Yahweh gave to Moses. Joshua told the Israelites to prepare to cross the Jordan River.</p><p data-indent="2">Here are some other possible section headings:</p><blockquote data-indent="3"><p>Yahweh told Joshua to be strong and courageous</p></blockquote><blockquote data-indent="3"><p>Yahweh told Joshua to lead the people across the Jordan River</p></blockquote></div><div data-bnType="OpenTranslatorsNotesParagraph" data-startVerseId="1006001001" data-endVerseId="1006001005"><h3>Paragraph 1:1–5</h3><p data-indent="1">Moses led the Israelite people through the wilderness for forty years. At the end of the book of Deuteronomy the people were almost ready to enter the land of Canaan, and Moses died. Here at the beginning of the book of Joshua, Yahweh put Joshua in command of the Israelites, and told him to lead them into Canaan. Yahweh promised to be with Joshua and to help him.</p></div><h4>1:1a</h4><div data-bnType="OpenTranslatorsNotesTranslationOptions" data-verse="1:1a"><p data-bnType="OpenTranslatorsNotesTranslationOptionsDefaultOption"><strong>Now after the death of His servant Moses,</strong></p><ul data-bnType="OpenTranslatorsNotesTranslationOptionsAdditionalTranslationOptions"><li><p>¶ After Moses the servant of Yahweh died,</p></li><li><p>¶ Moses had recently died. He was a person who served Yahweh.</p></li></ul></div><p data-indent="1"><strong>after the death of His servant Moses:</strong> The <em>death of…Moses</em> is described in Deuteronomy 34. The book of Joshua follows that story. This sentence is the opening words of a new book. Think about the natural way to begin a new book in your language. In some languages it may be better to begin with a main clause, for example:</p><blockquote data-indent="2"><p>Moses had <span data-bnType="implied">recently</span> died</p></blockquote><p data-indent="2"><strong>His servant Moses:</strong> The Hebrew word that the BSB translates as <em>servant</em> can also be translated as “slave.” It refers to someone who must obey the commands of a master. It is recommended that you use a term that indicates the lowly position of a slave or a servant.</p><p data-indent="2">In some languages it may be more natural to place Moses’ title <em>His servant</em> after his name, for example:</p><blockquote data-indent="3"><p>Moses, Yahweh’s servant</p></blockquote><p data-indent="2">In some languages it may be more natural to use the verb “serve” instead of the noun servant, for example:</p><blockquote data-indent="3"><p>Moses, a man who served Yahweh</p></blockquote><div data-bnType="OpenTranslatorsNotesGeneralComment"><h5><strong>General Comment on 1:1a</strong></h5><p data-indent="1">Here are some other ways to translate this part of the verse:</p><blockquote data-indent="2"><p>After Moses, Yahweh’s servant, died</p></blockquote><blockquote data-indent="2"><p>Moses had recently died. He was a man who served Yahweh.</p></blockquote></div><h4>1:1b</h4><div data-bnType="OpenTranslatorsNotesTranslationOptions" data-verse="1:1b"><p data-bnType="OpenTranslatorsNotesTranslationOptionsDefaultOption"><strong>the LORD spoke to Joshua son of Nun, Moses’ assistant, saying,</strong></p><ul data-bnType="OpenTranslatorsNotesTranslationOptionsAdditionalTranslationOptions"><li><p>Yahweh spoke to Nun’s son, Joshua, who had assisted Moses.</p></li><li><p>Then Yahweh spoke to Joshua. Joshua’s father was Nun, and he was the person who helped Moses.</p></li></ul></div><p data-indent="1"><strong>the LORD spoke to Joshua son of Nun:</strong> This is the first event of the book. If you used a main clause to translate 1:1a you may want to use a temporal phrase here, such as “at that time.”</p><p data-indent="2">Here is another way to translate this clause:</p><blockquote data-indent="3"><p><span data-bnType="implied">At that time</span> Yahweh said to Joshua the son of Nun</p></blockquote><p data-indent="2"><strong>the LORD:</strong> The Hebrew word that the BSB translates <em>LORD</em> is “Yahweh,” the personal name of God. See the notes in the Introduction on how to translate this term.</p><p data-indent="2"><strong>Joshua son of Nun:</strong> In some languages it may be more natural to say:</p><blockquote data-indent="3"><p>Joshua whose father was called Nun</p></blockquote><p data-indent="1"><strong>Moses’ assistant:</strong> The Hebrew word that the BSB translates as <em>assistant</em> comes from a verb that means “to be an attendant on” or “to wait on.” It is different from the Hebrew word translated as “servant” in 1:1a. This word was used when Joshua accompanied Moses up Mount Sinai (Exodus 24:13) where the BSB translated it as “attendant.” Joshua’s task was not that of a servant but of an assistant.</p><p data-indent="2">Here are some other ways to translate this phrase:</p><blockquote data-indent="3"><p>the person who helped Moses</p></blockquote><blockquote data-indent="3"><p>Moses’ aide (NIV)</p></blockquote><blockquote data-indent="3"><p>Moses’ helper (GNT)</p></blockquote><p data-indent="2">Here are some ways to translate this part of the verse:</p><blockquote data-indent="3"><p>Yahweh said to Joshua, Nun’s son, who had been Moses’ assistant</p></blockquote><blockquote data-indent="3"><p>Yahweh spoke to Joshua. Joshua was the son of Nun, and he was the person who had helped Moses</p></blockquote>`;

  const resultHtml = roundTrip(originalHtml);
  expect(resultHtml).toBe(originalHtml);
});

test("parsing Tyndale content with brefs and items", () => {
  // eslint-disable-next-line
  const html = `<p class="theme-title">Human Sexuality</p><p class="theme-body-fl">When God created the first human beings in his own image, he created them as sexual beings, male and female (<a href="?bref=Gen.1.27">Gen 1:27</a>). Through their sexuality, they were to fill and govern the world (<a href="?bref=Gen.1.28">1:28</a>) and provide intimate companionship for one another in marriage (<a href="?bref=Gen.2.18-25">2:18-25</a>). Male and female sexuality is central to what it means to be human and is included in God’s declaration of creation as “very good” (<a href="?bref=Gen.1.31">1:31</a>).</p><p class="theme-body">Sexual intimacy united the first man and woman as one, an effect that sexual intimacy continues to have. Since biblical sexuality is not just physical but has the total person in view, it validates sexual relations only as part of the partners’ permanent mutual commitment to each other’s ultimate good. The Bible speaks of engaging in sexual intercourse as literally “knowing” another person intimately (see <a href="?item=Gen.4.1_StudyNote_Filament&type=TyndaleStudyNotes">study note on Gen 4:1</a>). Since Creation, God’s intended context for sexual activity has been the intimate union of marriage—namely, a permanent and loving heterosexual commitment (<a href="?bref=Gen.1.27-28">Gen 1:27-28</a>; <a href="?bref=Gen.2.23-24">2:23-24</a>). The sexual relationship cements the marriage bond in an intimacy that may result in reproduction and can continue even when reproduction is no longer possible.</p><p class="theme-body">Although sexuality was created before sin, it did not emerge unscathed from human rebellion. Sexuality is a powerful force that is easily corrupted if not carefully channeled (see <a href="?bref=Lev.18.1-30">Lev 18</a>; <a href="?bref=1Thes.4.3-8">1 Thes 4:3-8</a>). Sexual intimacy apart from marital commitment perverts the order that God intended for creation. Incest, for example, violates sexual boundaries (see <a href="?bref=Lev.18.7-18">Lev 18:7-18</a>), collapses family structures (see <a href="?bref=Gen.19.30-38">Gen 19:30-38</a>), and fragments the community. Whereas perverted sexuality causes much harm, tears the community down (see <a href="?bref=Gen.38.1-30">Gen 38:1-30</a>; <a href="?bref=Gen.39.7-9">39:7-9</a>; <a href="?bref=Judg.19.1-20.48">Judg 19–20</a>), and exalts the individual (see <a href="?bref=2Sam.13.11-14">2 Sam 13:11-14</a>), biblical sexuality builds up the sexual partners and the community.</p><p class="theme-body">Human sexuality has been damaged through our fall into sin (<a href="?bref=Gen.3.1-24">Gen 3</a>), but God has redeemed it through the death and resurrection of Jesus Christ (see <a href="?bref=1Cor.6.12-20">1 Cor 6:12-20</a>; <a href="?bref=Eph.5.31-33">Eph 5:31-33</a>). He restores sexual wholeness in those who trust his work in their lives by the Holy Spirit (<a href="?bref=1Cor.6.9-11">1 Cor 6:9-11</a>, <a href="?bref=1Cor.6.15-20">15-20</a>; <a href="?bref=1Thes.4.1-8">1 Thes 4:1-8</a>). Those who commit their sexuality to Christ’s work in their lives can serve as a testament to others of God’s love for his people (<a href="?bref=Eph.5.25-33">Eph 5:25-33</a>).</p><p class="theme-refs-title">Passages for Further Study</p><p class="theme-refs"><a href="?bref=Gen.1.27-28">Gen 1:27-28</a>; <a href="?bref=Gen.2.18-25">2:18-25</a>; <a href="?bref=Lev.18.1-30">Lev 18:1-30</a>; <a href="?bref=Deut.22.13-29">Deut 22:13-29</a>; <a href="?bref=Ruth.4.11-13">Ruth 4:11-13</a>; <a href="?bref=2Sam.11.2-27">2 Sam 11:2-27</a>; <a href="?bref=Ps.127.3-5">Ps 127:3-5</a>; <a href="?bref=Eccl.2.8-11">Eccl 2:8-11</a>; <a href="?bref=Song.1.8-8.14">Song 1:8–8:14</a>; <a href="?bref=Mal.2.15-16">Mal 2:15-16</a>; <a href="?bref=Matt.19.3-12">Matt 19:3-12</a>; <a href="?bref=1Cor.6.12-7.40">1 Cor 6:12–7:40</a>; <a href="?bref=Eph.5.31-33">Eph 5:31-33</a>; <a href="?bref=1Thes.4.3-8">1 Thes 4:3-8</a></p>`

  const json = parseHtmlAsJson(html)

  // eslint-disable-next-line
  expect(json).toBe(`{"type":"doc","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"Human Sexuality"}]},{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"When God created the first human beings in his own image, he created them as sexual beings, male and female ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001001027,"endVerse":1001001027}]}}],"text":"Gen 1:27"},{"type":"text","text":"). Through their sexuality, they were to fill and govern the world ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001001028,"endVerse":1001001028}]}}],"text":"1:28"},{"type":"text","text":") and provide intimate companionship for one another in marriage ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001002018,"endVerse":1001002025}]}}],"text":"2:18-25"},{"type":"text","text":"). Male and female sexuality is central to what it means to be human and is included in God’s declaration of creation as “very good” ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001001031,"endVerse":1001001031}]}}],"text":"1:31"},{"type":"text","text":")."}]},{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"Sexual intimacy united the first man and woman as one, an effect that sexual intimacy continues to have. Since biblical sexuality is not just physical but has the total person in view, it validates sexual relations only as part of the partners’ permanent mutual commitment to each other’s ultimate good. The Bible speaks of engaging in sexual intercourse as literally “knowing” another person intimately (see "},{"type":"text","marks":[{"type":"resourceReference","attrs":{"resourceId":"Gen.4.1_StudyNote_Filament","resourceType":"TyndaleStudyNotes"}}],"text":"study note on Gen 4:1"},{"type":"text","text":"). Since Creation, God’s intended context for sexual activity has been the intimate union of marriage—namely, a permanent and loving heterosexual commitment ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001001027,"endVerse":1001001028}]}}],"text":"Gen 1:27-28"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001002023,"endVerse":1001002024}]}}],"text":"2:23-24"},{"type":"text","text":"). The sexual relationship cements the marriage bond in an intimacy that may result in reproduction and can continue even when reproduction is no longer possible."}]},{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"Although sexuality was created before sin, it did not emerge unscathed from human rebellion. Sexuality is a powerful force that is easily corrupted if not carefully channeled (see "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1003018001,"endVerse":1003018030}]}}],"text":"Lev 18"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1053004003,"endVerse":1053004008}]}}],"text":"1 Thes 4:3-8"},{"type":"text","text":"). Sexual intimacy apart from marital commitment perverts the order that God intended for creation. Incest, for example, violates sexual boundaries (see "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1003018007,"endVerse":1003018018}]}}],"text":"Lev 18:7-18"},{"type":"text","text":"), collapses family structures (see "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001019030,"endVerse":1001019038}]}}],"text":"Gen 19:30-38"},{"type":"text","text":"), and fragments the community. Whereas perverted sexuality causes much harm, tears the community down (see "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001038001,"endVerse":1001038030}]}}],"text":"Gen 38:1-30"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001039007,"endVerse":1001039009}]}}],"text":"39:7-9"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1007019001,"endVerse":1007020048}]}}],"text":"Judg 19–20"},{"type":"text","text":"), and exalts the individual (see "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1010013011,"endVerse":1010013014}]}}],"text":"2 Sam 13:11-14"},{"type":"text","text":"), biblical sexuality builds up the sexual partners and the community."}]},{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"Human sexuality has been damaged through our fall into sin ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001003001,"endVerse":1001003024}]}}],"text":"Gen 3"},{"type":"text","text":"), but God has redeemed it through the death and resurrection of Jesus Christ (see "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1047006012,"endVerse":1047006020}]}}],"text":"1 Cor 6:12-20"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1050005031,"endVerse":1050005033}]}}],"text":"Eph 5:31-33"},{"type":"text","text":"). He restores sexual wholeness in those who trust his work in their lives by the Holy Spirit ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1047006009,"endVerse":1047006011}]}}],"text":"1 Cor 6:9-11"},{"type":"text","text":", "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1047006015,"endVerse":1047006020}]}}],"text":"15-20"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1053004001,"endVerse":1053004008}]}}],"text":"1 Thes 4:1-8"},{"type":"text","text":"). Those who commit their sexuality to Christ’s work in their lives can serve as a testament to others of God’s love for his people ("},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1050005025,"endVerse":1050005033}]}}],"text":"Eph 5:25-33"},{"type":"text","text":")."}]},{"type":"paragraph","attrs":{},"content":[{"type":"text","text":"Passages for Further Study"}]},{"type":"paragraph","attrs":{},"content":[{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001001027,"endVerse":1001001028}]}}],"text":"Gen 1:27-28"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1001002018,"endVerse":1001002025}]}}],"text":"2:18-25"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1003018001,"endVerse":1003018030}]}}],"text":"Lev 18:1-30"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1005022013,"endVerse":1005022029}]}}],"text":"Deut 22:13-29"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1008004011,"endVerse":1008004013}]}}],"text":"Ruth 4:11-13"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1010011002,"endVerse":1010011027}]}}],"text":"2 Sam 11:2-27"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1019127003,"endVerse":1019127005}]}}],"text":"Ps 127:3-5"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1021002008,"endVerse":1021002011}]}}],"text":"Eccl 2:8-11"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1022001008,"endVerse":1022008014}]}}],"text":"Song 1:8–8:14"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1039002015,"endVerse":1039002016}]}}],"text":"Mal 2:15-16"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1041019003,"endVerse":1041019012}]}}],"text":"Matt 19:3-12"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1047006012,"endVerse":1047007040}]}}],"text":"1 Cor 6:12–7:40"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1050005031,"endVerse":1050005033}]}}],"text":"Eph 5:31-33"},{"type":"text","text":"; "},{"type":"text","marks":[{"type":"bibleReference","attrs":{"verses":[{"startVerse":1053004003,"endVerse":1053004008}]}}],"text":"1 Thes 4:3-8"}]}]}`);
})

test("comments mark", () => {
  const html = `<p><span data-bnType="comments" data-threadId="123">Hello world</span></p>`;
  const json = parseHtmlAsJson(html);
  expect(json).toBe(`{"type":"doc","content":[{"type":"paragraph","attrs":{},"content":[{"type":"text","marks":[{"type":"comments","attrs":{"comments":{"threadId":"123"}}}],"text":"Hello world"}]}]}`);

  const resultHtml = roundTrip(html);
  expect(resultHtml).toBe(html);
});
